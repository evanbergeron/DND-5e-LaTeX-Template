% DND 5e LaTeX Style File
% Created by Evan Bergeron
% Modified by Christopher Liu
% Modified by Yannic Meyer Feb 2015
% December 2015

%
% Prerequisite Packages
%
\usepackage{titlesec}       % Used to adjust (sub)section colors and fonts
\usepackage{lipsum}         % Filler text
\usepackage{multicol}       % Two cols
\usepackage[cm]{fullpage}   % Small margins
\usepackage{bookman}        % Closest built-in font I could find
\usepackage[T1]{fontenc}
\usepackage{mdframed}       % Used for green boxes
\usepackage[table]{xcolor}
\usepackage{array}
\usepackage{tabularx}
\usepackage{tikz}
\usepackage{keycommand}
\usepackage[pages=all]{background} %background images with different backgrounds for even and odd pages
\usepackage{fancyhdr} %adaptation of the footers
\usepackage{nameref} %necessary to call the current section name in the footer
\usepackage[most]{tcolorbox} %for comment- and quotebox

% Modularization is a good thing.
\usepackage{dndmonster}
\usepackage{dndsections}
\usepackage{dndcomment}
\usepackage{dndtable}
\usepackage{dndbackgroundimg}
\usepackage{dndquote}

%
% Style Parameters
%
% Font environment
\newenvironment{lmss}{\fontfamily{lmss}\selectfont}{}

\setlength{\columnsep}{1cm}
% Define colors, sampled from the books.
\usepackage{color}
\definecolor{bgtan}{rgb}{0.97, 0.95, 0.9}
\definecolor{titlered}{rgb}{0.38, 0.14, 0.09}
\definecolor{undergold}{rgb}{0.81, 0.75, 0.53}
\definecolor{uppergold}{HTML}{b89a67}
\definecolor{puregold}{HTML}{e69a28}
\definecolor{commentgreen}{rgb}{0.88, 0.90, 0.75}
\definecolor{monsterbg}{rgb}{0.94, 0.86, 0.71}
\definecolor{monstertan}{HTML}{FDF1DC}

\pagecolor{bgtan}

%Setup for custom footer
\pagestyle{fancy}

\footskip = 50pt %push the footer down so it fits with the decal from the bg-img
\fancyhfoffset[LE]{28pt} % push the footer left on even pages so it fits the decal
\fancyhfoffset[RO]{30pt} % push the footer right on odd pages so it fits the decalbg-img

\newcommand{\sectionnamecustom}{\textsc \@currentlabelname}

\fancyhead{} % clear all header fields
\fancyfoot{} % clear all footer fields
\fancyfoot[CO]{\raisebox{-10pt}{\hspace*{14cm}\textcolor{uppergold}{\sectionnamecustom}}} % section titles for odd pages
\fancyfoot[CE]{\raisebox{-10pt}{\hspace*{-14cm}\textcolor{uppergold}{\sectionnamecustom}}} % section titles for even pages
\fancyfoot[RO,LE]{\textcolor{uppergold}{\thepage}} %pagenumbers 
\renewcommand{\headrulewidth}{0.0pt} %no rule for header
\renewcommand{\footrulewidth}{0.0pt} %no rule for footer

% Fancy DnD 5e-style hline
\renewcommand{\hline}{
\noindent
  \begin{tikzpicture}[]
    \draw [titlered, fill=titlered] (0, 0) --(0,0.1) -- (\textwidth, 0.08);
  \end{tikzpicture}
}


% Either hilariously, or infuriatingly, the \ifcommandkey
% implementation is buggy. Here is a re-implementation
% from tex.stackexchange.
\begingroup
  \makeatletter
  \catcode`\/=8 %
  \@firstofone
    {
      \endgroup
      \renewcommand{\ifcommandkey}[1]{%
        \csname @\expandafter \expandafter \expandafter
        \expandafter \expandafter \expandafter  \expandafter
        \kcmd@nbk \commandkey {#1}//{first}{second}//oftwo\endcsname
      }
   }
